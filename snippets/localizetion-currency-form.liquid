<style>
  @media (max-width: 767px) {
    .currency-modal {
      bottom: 100%;
    }
  }
</style>

<div x-data="{ 
  open: false, 
  search: '',
  get filteredCountries() {
    if (!this.search) return this.$refs.countryList.querySelectorAll('li');
    const query = this.search.toLowerCase();
    return Array.from(this.$refs.countryList.querySelectorAll('li')).filter(li => {
      const text = li.textContent.toLowerCase();
      return text.includes(query);
    });
  }
}" class="relative block text-left">
  <button @click="open = !open" class="flex w-full items-center justify-between gap-2 px-3 py-2.5 md:py-2 text-sm font-medium border rounded-xl hover:bg-gray-100">
    <span>
      <span class="md:hidden">{{ localization.country.name }} -</span>
      <span>{{ localization.country.currency.symbol }}</span>
    </span>
    <svg
      class="w-4 h-4"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24">
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M19 9l-7 7-7-7" />
    </svg>
  </button>
  <div
    x-show="open"
    x-cloak
    @click.away="open = false"
    x-transition:enter="transition ease-out duration-100"
    x-transition:enter-start="opacity-0 scale-90"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-100"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-90"
    class="absolute right-0 mt-2 w-60 currency-modal origin-bottom-right md:origin-top-right bg-white border border-gray-200 rounded-lg shadow-lg z-50">

    <!-- Search Input -->
    <div class="p-2 border-b border-gray-200">
      <input
        type="text"
        x-model="search"
        @keydown.escape="open = false"
        placeholder="Search countries..."
        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
    </div>

    <form
      class="py-1"
      method="post"
      action="/localization"
      accept-charset="UTF-8"
      enctype="multipart/form-data"
      id="currency_form">
      <input
        type="hidden"
        name="form_type"
        value="localization" />
      <input
        type="hidden"
        name="utf8"
        value="âœ“" />
      <input
        type="hidden"
        name="_method"
        value="put" />
      <input
        type="hidden"
        name="return_to"
        value="{{ request.path }}" />

      <ul class="text-sm text-gray-700 max-h-64 overflow-y-auto" x-ref="countryList">
        {% for country in localization.available_countries %}
          <li x-show="!search || $el.textContent.toLowerCase().includes(search.toLowerCase())">
            <button
              type="submit"
              name="currency_code"
              value="{{ country.currency.iso_code }}"
              class="flex justify-between w-full text-left px-4 py-2 hover:bg-gray-100 {% if country.currency.iso_code == localization.currency.iso_code %}font-semibold{% endif %}">
              <span>{{ country.name }}</span>
              <span class="transition-opacity">
                {{ country.currency.iso_code }}{{ country.currency.symbol }}</span>
            </button>
          </li>
        {% endfor %}
      </ul>
    </form>
  </div>
</div>