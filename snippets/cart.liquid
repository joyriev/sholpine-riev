<div x-data>
  <div
    x-cloak
    @click="$store.cart.isOpen = false"
    :class="$store.cart.isOpen ? 'left-0 opacity-50' : 'left-full opacity-0'"
    class="fixed top-0 h-full w-full bg-black z-40 transition-all duration-300"></div>
  <div
    x-cloak
    :class="$store.cart.isOpen ? 'right-0' : 'right-[-28rem]'"
    class="fixed top-0 h-full w-full max-w-md bg-white shadow-2xl z-50 flex flex-col transition-all duration-300">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b">
      <div class="flex items-center gap-3">
        <h2 class="text-4xl font-bold">Cart</h2>
        <span class="w-2 h-2 bg-black rounded-full"></span>
        <span class="text-4xl font-bold" x-text="$store.cart.totalItems"></span>
      </div>
      <button @click="$store.cart.isOpen = false" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    {% comment %} Scrollable Content {% endcomment %}
    <div class="flex-1 overflow-y-auto">

      {% comment %} Free Shipping Progress {% endcomment %}
      {% if settings.cart_progress %}
        <div class="p-6 border-b">
          <p class="text-center text-lg">
            You're
            <span class="font-bold">$152.00</span>
            away from free shipping!
          </p>
          <div class="relative pt-6 mb-8">
            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div class="h-full bg-teal-500 w-1/4"></div>
            </div>
            <div class="flex flex-col items-center absolute top-2 left-1/3">
              <div class="size-10 rounded-full border-2 border-teal-500 bg-white flex items-center justify-center">
                <svg
                  class="size-6 text-teal-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <span class="text-xs mt-2 font-medium">Free Shipping</span>
            </div>
            <div class="flex flex-col items-center absolute top-2 left-3/4">
              <div class="size-10 rounded-full border-2 border-gray-300 bg-white flex items-center justify-center">
                <svg
                  class="size-6 text-gray-300"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                </svg>
              </div>
              <span class="text-xs mt-2 font-medium">5% Off</span>
            </div>
          </div>
        </div>
      {% endif %}

      <h3 x-show="$store.cart.items.length === 0" class="text-2xl font-bold text-center mt-12">Your cart is empty!</h3>

      {% comment %} Cart Items {% endcomment %}
      <div class="p-6 border-b flex flex-col gap-6 [&_.border-b:last-child]:border-b-0 [&_.border-b:last-child]:pb-0">
        <template x-for="product in $store.cart.items">
          <div class="flex gap-4 border-b pb-6">
            <div class="size-24 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
              <img
                :src="product.image"
                :alt="product.title"
                height="96"
                width="96"
                class="w-full h-full object-cover">
            </div>
            <div class="flex-1 flex flex-col">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <h3 class="font-semibold mb-1 line-clamp-1" x-text="product.title"></h3>
                  <p class="text-gray-500">
                    <span x-text="product.variant_title"></span>
                    -
                    <span x-text="product.price"></span>
                  </p>
                </div>
                <button
                  @click="$store.cart.changeItem(product.key)"
                  :disabled="$store.cart.isRemoving === product.key"
                  class="p-2 hover:bg-gray-100 rounded-lg transition-colors flex disabled:cursor-not-allowed">
                  <svg
                    x-show="$store.cart.isRemoving !== product.key"
                    class="w-5 h-5 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  <div
                    x-show="$store.cart.isRemoving === product.key"
                    class="text-gray-500 inline-block size-5 animate-spin rounded-full border-2 border-solid border-current border-e-transparent align-[-0.125em] text-surface motion-reduce:animate-[spin_1.5s_linear_infinite]"
                    role="status">
                    <span class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]">Loading...</span>
                  </div>
                </button>
              </div>
              <div class="flex items-center justify-between mt-auto">
                <div class="flex items-center border border-gray-300 rounded">
                  <button
                    @click="$store.cart.changeItem(product.key, 'decrease', product.quantity - 1)"
                    :disabled="$store.cart.isDecreasing === product.key || product.quantity === 1"
                    class="size-8 flex justify-center items-center hover:bg-gray-100 transition-colors disabled:cursor-not-allowed">
                    <span x-show="$store.cart.isDecreasing !== product.key">-</span>
                    <div x-show="$store.cart.isDecreasing === product.key" class="text-gray-500 inline-block size-5 animate-spin rounded-full border-2 border-solid border-current border-e-transparent align-[-0.125em] text-surface motion-reduce:animate-[spin_1.5s_linear_infinite]">
                      <span class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]">Loading...</span>
                    </div>
                  </button>
                  <span class="h-8 w-10 flex justify-center items-center font-medium border-x border-gray-300" x-text="product.quantity"></span>
                  <button
                    @click="$store.cart.changeItem(product.key, 'increase', product.quantity + 1)"
                    :disabled="$store.cart.isIncreasing === product.key"
                    class="size-8 flex justify-center items-center hover:bg-gray-100 transition-colors disabled:cursor-not-allowed">
                    <span x-show="$store.cart.isIncreasing !== product.key">+</span>
                    <div x-show="$store.cart.isIncreasing === product.key" class="text-gray-500 inline-block size-5 animate-spin rounded-full border-2 border-solid border-current border-e-transparent align-[-0.125em] text-surface motion-reduce:animate-[spin_1.5s_linear_infinite]">
                      <span class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]">Loading...</span>
                    </div>
                  </button>
                </div>
                <span class="text-lg font-bold" x-text="product.line_price_formatted"></span>
              </div>
            </div>
          </div>
        </template>
      </div>
      {% comment %} Cart Upsell {% endcomment %}
      {% if settings.cart_upsell and settings.cart_upsell.products_count > 0 %}
        <div class="p-6">
          <h3 class="text-2xl font-bold text-center mb-4">You'll love these</h3>
          <div class="flex flex-col gap-4">
            <template x-for="product in $store.cart.upsellProducts">
              <div class="rounded-lg p-3 border">
                <div class="flex gap-6 items-center">
                  <div class="size-24 bg-white rounded-lg overflow-hidden flex-shrink-0">
                    <img
                      height="96"
                      width="96"
                      :src="product.image"
                      :alt="product.title"
                      class="w-full h-full object-cover">
                  </div>
                  <div class="flex-1">
                    <h4 class="font-bold text-lg mb-1 line-clamp-1" x-text="product.title"></h4>
                    <p class="text-gray-500">50ML</p>
                    <div class="flex gap-3 items-center justify-between">
                      <p class="font-bold text-lg" x-text="product.price"></p>
                      <button @click="$store.cart.addToCart(product.id)" class="bg-black text-white p-2 px-4 w-auto rounded-full font-medium hover:bg-gray-800 transition-colors">
                        Add
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
        <script>
          const upsellProducts = [
            {% for product in settings.cart_upsell.products | limit: 5 %}
              {%  assign selected_variant = product.variants.first %}
              {% for variant in product.variants %}
                {% if variant.title == '50ML' %}
                  {% assign selected_variant = variant %}
                {% endif %}
              {% endfor %}
              {
                id: {{ selected_variant.id }},
                title: "{{ product.title }}",
                price: "{{ selected_variant.price }}",
                image: "{{ product.featured_image | image_url: width: 200, height: 200 }}",
              },
            {% endfor %}
          ];
        </script>
      {% endif %}
    </div>
    {% comment %} Checkout Button {% endcomment %}
    <div class="p-6 border-t bg-white">
      <a href="{{ shop.url }}/checkout" class="w-full block text-center bg-black text-white py-4 rounded font-medium text-lg hover:bg-gray-800 transition-colors">
        Checkout •
        <span x-text="$store.cart.cartTotal"></span>
      </a>
    </div>
  </div>
</div>